<!doctype html>
<html lang="zh-CN">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>简易新闻汇</title>
<style>
  :root{
    --fg:#111; --muted:#6b7280; --link:#0b57d0; --border:#e5e7eb;
    --h1: 20px; --meta: 13px; --title: 18px; --container: min(760px, 92vw);
  }
  body{ margin:0; color:var(--fg); background:#fff;
        font: 16px/1.6 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"PingFang SC","Microsoft YaHei",sans-serif; }
  .wrap{ width:var(--container); margin: max(8px, env(safe-area-inset-top)) auto 24px;
         padding: 0 max(12px, env(safe-area-inset-left)) 24px max(12px, env(safe-area-inset-right)); }
  header{ padding:12px 0 6px; border-bottom:1px solid var(--border); }
  h1{ font-size:var(--h1); margin:0 0 4px; font-weight:700; display:flex; gap:6px; align-items:center; }
  .ut{ font-size:var(--meta); color:var(--muted); }
  ul{ list-style:none; margin:0; padding:0; }
  li{ border-bottom:1px solid var(--border); }
  a.item{ display:block; padding:10px 0; text-decoration:none; min-height:44px; }
  .t{ font-size:var(--title); line-height:1.45; color:var(--link); word-break:break-word; overflow-wrap:anywhere; }
  .m{ display:block; margin-top:4px; font-size:var(--meta); color:var(--muted); }
  .read .t { color: #999 !important; }  /* ✅ 新增：已读变灰 */
</style>
<body>
  <div class="wrap">
    <header>
      <h1>📰 简易新闻汇</h1>
      <div id="updated" class="ut">更新中…</div>
    </header>
    <ul id="list"></ul>
  </div>

<script>
function timeAgo(ts){
  const d = Math.floor(Date.now()/1000 - ts);
  if (d>=86400) return Math.floor(d/86400)+"天前";
  if (d>=3600) return Math.floor(d/3600)+"小时前";
  if (d>=60) return Math.floor(d/60)+"分钟前";
  return "刚刚";
}

// 获取已读链接列表
const readLinks = JSON.parse(localStorage.getItem("readLinks") || "[]");

fetch("news.json?_="+Date.now())
  .then(r=>r.json())
  .then(d=>{
    const upd = new Date(d.updated*1000);
    document.getElementById("updated").textContent =
      "更新于 " + upd.getFullYear()+"-"+String(upd.getMonth()+1).padStart(2,'0')+"-"+String(upd.getDate()).padStart(2,'0')+
      " "+String(upd.getHours()).padStart(2,'0')+":"+String(upd.getMinutes()).padStart(2,'0');
    const list = document.getElementById("list");
    d.items.forEach(it=>{
      const li = document.createElement("li");
      const isRead = readLinks.includes(it.url);
      li.innerHTML = `<a class="item${isRead ? ' read' : ''}" href="${it.url}" target="_blank" rel="noopener">
          <span class="t">${it.title}</span>
          <span class="m">来源：${it.source} · ${timeAgo(it.published)}</span>
        </a>`;
      // 添加点击监听器，标记为已读
      li.querySelector("a").addEventListener("click", () => {
        if (!readLinks.includes(it.url)) {
          readLinks.push(it.url);
          localStorage.setItem("readLinks", JSON.stringify(readLinks));
        }
      });
      list.appendChild(li);
    });
  })
  .catch(() => { document.getElementById("updated").textContent = "无法加载新闻数据"; });
</script>
</body>
</html>
